<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <meta http-equiv="content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="author" content="Pavel Cherenkov" />
    <meta name="description" content="udpxy: UDP to HTTP (multicast to unicast) fast and lightweight relay daemon. It is recognized as the definite POSIX-platform open-source IPTV-oriented solution for unicast HTTP streaming." />
    <meta name="keywords" content="UDP to HTTP relay daemon IPTV unicast streaming" />
    <link rel="stylesheet" type="text/css" href="udpxy.css" />
    <title>udpxy - Руководство пользователя</title>
    <!-- base href="http://www.udpxy.com" /-->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-31358818-1']);
  _gaq.push(['_setDomainName', 'udpxy.com']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>
<body>
    <div id="front_page">
        <img src="images/udpxy_hdbar1.jpg" id="logo" alt="logo" \>
        <a class="langswitch" href="howtos-en.html">English</a>
        <div id="navmenu">
            <a href="index-ru.html" title="Главная страница">Главная</a>
            <a href="features-ru.html" title="Функциональные возможности">Возможности</a>
            <a href="http://sourceforge.net/projects/udpxy" title="Загрузить udpxy">Загрузить</a>
            <a href="faq-ru.html" title="Часто задаваемые вопросы">Вопросы</a>
            <a href="howtos-ru.html" title="Руководства HOWTO"><b>Руководства</b></a>
            <a href="support-ru.html" title="Как получить поддержку">Поддержка</a>
            <a href="forum" title="Дискуссионный форум">Форум</a>
        </div> <!-- navmenu -->
        <div id="content">
            <div id="faq-txt">
            <h3>Руководство пользователя пакета udpxy</h3>
            <p>Данное руководство составлено с целью разъяснить принципы и основные алгоритмы работы приложений, входящих в состав пакета udpxy (в настоящее время эти приложения: udpxy, udpxrec). Руководство также ставит своей целью более подробно описать значение параметров командной строки и дать примеры их использования.</p>

            <h4>Приложение udpxy</h4>

            <p><i>udpxy</i> - серверное приложение, обладающее при определённым образом заданных параметрах атрибутами UNIX daemon-а. Основная задача udpxy заключается в передаче данных, считанных из мультикаст-канала (рассылающего данные подписчикам по протоколу UDP), в клиентское соединение, работающее в протоколе TCP. Таким образом, клиент, не имея возможности работать с протоколом UDP, может послать запрос udpxy, установить TCP соединение и работать с данными, полученными из указанного (в изначальном запросе) мультикаст-канала.</p>

            <p>Основным сценарием использования udpxy является воспроизведение видео или аудио потоков, транслирующихся в локальной сети. Не все видео и аудио плееры (приложения) поддерживают считывание информации непосредственно из мультикаст-канала, но большинство обладает возможностью читать видео- или аудио-поток через HTTP запрос (по протоколу TCP). Клиент - плеер - посылает HTTP (GET) запрос udpxy в виде URL с параметрами, идентифицирующими источник данных (адрес и порт мультикаст-канала); <i>udpxy</i> "подписывается" на соответствующий канал и начинает считывать из него данные, которые затем передаются (по установленному TCP соединению) клиенту. Приём и передача данных происходят в цикле до тех пор, пока одна из сторон не прервёт соединение: источник перестанет передавать данные или же клиент со своей стороны прекратит их приём.</p>

            <p><b>Примечание:</b> приложение считает соединение прерванным и том случае, если оно не может выполнить операцию чтения или записи по данному соединению в течении заданного периода времени - "тайм-аута". Тайм-аут для чтения устанавливается по умолчанию в 5 (пять) секунд, но может быть установлен извне через значение (в секундах) переменной среды UDPXY_RCV_TMOUT.</p>

            <h4>Протоколы передачи и форматы данных</h4>

            <p>В настоящее время udpxy поддерживает следующие протоколы передачи аудио- и видео-данных:</p>
            <ul>
                <li>TS (MPEG-TS)</li>
                <li>RTP (MPEG-TS через RTP)</li>
            </ul>

            <p>Приложение идентифицирует поток по первому полученному сообщению. Тип потока определяет дальнейший способ обработки данных: в случае TS никакой дополнительной обработки не производится; если же данные передаются по RTP, udpxy "конвертирует" поток в TS (вычленяя из RTP пакетов данные MPEG-TS). Таким образом, во всех случаях клиенту выдаётся поток в формате TS. В случае, если udpxy не может идентифицировать тип потока, выдаётся ошибка и соединение с клиентом закрывается.</p>

            <h4>HTTP запросы к udpxy</h4>

            <p><i>1. Запрос на соединение:</i><br><br>
            <b>http://{address}:{port}/{protocol}/{channel_addr}:{channel_port}</b> , где:<br><br>
<b>{address}, {port}</b> - адрес и порт, на которых udpxy отслеживает ("слушает") запросы клиентов (см. параметры командной строки -a и -p);<br><br><b>{protocol} ::= udp | rtp</b> - формат потока; при указании RTP udpxy будет сразу считать протоколом передаваемого потока RTP, при указании UDP udpxy самостоятельно попытается определить протокол;<br><br><b>{channel_addr}</b> - IP адрес (мультикаст-) канала данных;<br>
<b>{channel_port}</b> - порт канала данных;</p>

            <p><i>2. Статус приложения:</i><br><br>
            <b>http://{address}:{port}/status</b> - по данной команде udpxy возвращает клиенту (HTML) страницу статуса приложения, отображающую в том числе статус клиентов и статистику скорости передачи данных клиентов (см. опцию -S).</p>

            <p><i>3. Перезапуск:</i><br><br>
            <b>http://{address}:{port}/restart</b> - по данной команде udpxy осуществляет перезапуск: закрывает соединения со всеми клиентами и переходит в состояние ожидания запросов.</p>

            <h4>Параметры командной строки udpxy</h4>
            <p><b>-v</b> - включить режим детального вывода в журнал [выключен по умолчанию]</p>
            <p>При включённом режиме детального вывода приложение будет выводить в журнал (см. параметр <b>-l</b>) отладочную информацию. Важно: вывод отладочной информации невозможен для исполняемых файлов udpxy, собранных в режиме lean. (Режим указан при запуске приложения без параметров сразу после номера сборки, например: udpxy 1.0_Chipmunk (build 8) standard, где режим сборки - "<i>standard</i>".</p>

            <p><b>-S</b> - передавать статистику о клиентских соединениях [по умолчанию - не передавать]</p>
            <p>Приложение будет накапливать и отображать (по HTTP-интерфейсу при запросе status) данные о средней скорости чтения и записи данных на потоках клиентов. Например, при наличии трёх клиентов, страница статуса udpxy покажет среднюю пропускную способность (в килобайтах в секунду) для каждого из клиентов.</p>

            <p><b>-T</b> - в случае запуска администратором (root) не пытаться работать в режиме сервера [по умолчанию - работать в режиме сервера (daemon), если процесс запущен пользователем с административными правами].</p>
            <p>При запуске непривилегированным пользователем udpxy будет работать в окне терминала и реагировать на интерактивные команды терминальной сессии, такие как выход в фоновый режим, прерывание по Ctrl-C и т.д. При запуске администратором (root) или пользователем с привилегиями администратора (0 == $EUID) приложение по умолчанию попытается работать в режиме сервера (daemon). Задействовав переключатель -T, пользователь может заставить udpxy при запуске администратором (root) работать с текущим терминалом.</p>
            <p><b>-a</b> - указать адрес (IPv4) или имя интерфейса для (HTTP) запросов к приложению [0.0.0.0 - по умолчанию].</p>
            <p><b>-p</b> - указать TCP порт для (HTTP) запросов к приложению (обязательный параметр).</p>
            <p><b>-m</b> - указать адрес (IPv4) или имя интерфейса мультикаст-каналов [0.0.0.0 - по умолчанию].</p>
            <p><b>-с</b> - максимальное количество клиентов, обслуживаемых одновременно [см. подсказку при запуске].</p>
            <p><i>udpxy</i> способно обслуживать не более обозначенного количества клиентов одновременно; приложение не даст установить соединение в превышение указанной квоты. Переопределив константу MAX_CLIENT_COUNT (в файле uopt.h), udpxy может быть скомпилировано с иным потолком соединений.</p>
            <p><b>-l</b> - записывать журнал приложения в указанный файл [по умолчанию - stderr].</p>
            <p>udpxy будет вести запись журнала в указанный файл; записи будут добавляться или же файл будет создан заново. В случае, если приложение будет запущено пользователем с правами администратора в режиме детального вывода (параметр -v), но файл не будет указан, udpxy выдаст ошибку.</p>
            <p><b>-B</b> - указать размер буфера для входящих данных [см. подсказку при запуске].</p>
            <p>Параметр заставляет udpxy накапливать входящие данные в буфере указанного размера прежде, чем передать их в соединение клиента. Данные читаются порциями, обозначаемыми как "сообщения" (messages). Таким образом, до тех пор, пока буфер указанного размера не будет заполнен должным количеством сообщений (определяемым параметром -R) или же (с момента получения первого пакета) не пройдёт время, обозначенное параметром -H, данные не будут переданы клиенту.</p>
            <p><b>-R</b> - указать максимальное количество сообщений, накапливаемых в буфере [см. подсказку при запуске].</p>
            <p>Параметр определяет, сколько сообщений должно быть в буфере прежде, чем он будет отправлен клиенту. Значение "1" (единица) ограничивают буфер одним сообщением, что означает, что все приходящие данные сразу же отправляются клиенту, и накапливания не происходит. Значение "-1" (минус единица) снимают ограничение с буфера: сообщения накапливаются до полного насыщения буфера. (В этом случае udpxy прерывает накопление, если в буфере осталось меньше места, чем то, что занимает последняя считанная запись.)</p>
            <p><b>Примечание:</b> при достаточно низкой скорости чтения входного потока и значительном размере буфера, клиент может посчитать время простоя (когда ему не поступают данные) чрезмерным и закрыть соединение или же отказывать в приёме сообщения. (В этом случае в журнале отладки можно видеть периодически появляющиеся записи: "write_buf: write: Resource temporarily unavailable").</p>
            <p><b>-H</b> - указать максимальное время (в секундах) накопления сообщений в буфере (см. параметры -B, -R) [см. подсказку при запуске].</p>
            <p>Приложение засекает время "прибытия" первого пакета (из серии), записываемого в буфер. После чтения каждого пакета, разница во времени сравнивается с указанной (в секундах) величиной: если пройденное время превышает заданный промежуток, накопленные в буфере данные передаются клиенту. Данное значение может быть также установлено с помощью переменной среды UDPXY_DHOLD_TMOUT.</p>
            <p><b>Важно:</b> значение параметра командной строки всегда будет иметь больший приоритет, чем значение переменной среды.</p>
            <p><b>-n</b> - смещение приоритета приложения ("nice value").</p>
            <p><b>-M</b> - периодически возобновлять подписку на мультикаст-канал [по умолчанию - 0 (секунд), т.е. не возобновлять].</p>
            <p>Установка данного параметра в значение N, отличное от нуля, заставляет приложение возобновлять подписку на мультикаст-канал(ы) клиента каждые N секунд.</p>

            </div> <!-- faq-txt -->
            <div id="footer">
                <p>Copyright &copy; 2012 Pavel V. Cherenkov</p>
            </div> <!-- footer -->
        </div> <!-- conent -->
    </div> <!-- front_page -->
</body>
</html>

<!-- Copyright 2011 by Pavel Cherenkov -->
<!-- EOF -->
